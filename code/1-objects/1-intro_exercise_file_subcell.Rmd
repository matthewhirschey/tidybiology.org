---
title: "Exercise: Subcellular Data"
output: html_notebook
---

##Load libraries
```{r load_block, warning=FALSE, echo=TRUE}
library(tidyverse)

#you're going to need a few more packages, so make sure to download them before trying to load the libraries; each of these is on CRAN, so you should be able to get them easily
library(janitor)
library(viridis)
library(ggridges)
```

#import data
The raw data were originally downloaded from [here](https://www.uniprot.org). But now, they are on the tidybiology website, so we can grab from there.  
```{r}
proteins_url <- "https://github.com/matthewhirschey/tidybiology.org/raw/main/data/uniprot-filtered-reviewed%253Ayes%2BAND%2Borganism%253A%2522Homo%2Bsapiens%2B%2528Human%2529%2B%255B96--.tab"
proteins_raw <- 
  read_tsv(proteins_url, col_names = TRUE) %>% 
  clean_names() %>% 
  dplyr::select(-status, -entry_name)
```

## Get to know your dataset
The `proteins_raw` object is a table (also called a dataframe), that has a series of columns and rows. The function `glimpse()` perfroms a quick peek at the data. We can see that this table has 7 columns (called 'Variables'), and 20431 rows (called 'Observations'). The name of each Variable is listed below (e.g. 'id', etc.). Importantly, R cares about capitalization, so `entry` is NOT the same as `ENTRY`. The type of variable is listed next (e.g. <fct>, <dbl>, etc.), as we discussed. Lastly, the first few observations are listed.  

```{r glimpse}
#Take a `glimpse` into the kinds of data in the proteins_raw dataframe

```

#clean
One of the biggest challenges when working with new data is to "clean" it, which means get it into a state that you can use it for something useful...like visualization! The overall goal is to clean-up a super messy column called `subcellular_location_cc`. We've already performed some cleaning steps for you below. While you might not understand everystep, read the comments to see what the code is doing.  

We are going to save this "cleaned" dataframe as a new object called 'subcell', which is short-hand for subcellular location. 
```{r}
#the overall goal is to clean-up a super messy column called "subcellular_location_cc"
subcell <- 
  proteins_raw %>%
  #looks for the word SUBCELLULAR, and filters ot include only those
  filter(str_detect(subcellular_location_cc, "SUBCELLULAR")) %>% 
  #removes the word SUBCELLULAR
  mutate(subcellular_location_cc = str_remove_all(subcellular_location_cc, "SUBCELLULAR LOCATION\\: ")) %>%
  #this is a trick to use separate() to split the text (sep = ...) and then drops the split
  separate(subcellular_location_cc, into = c("subcellular_location_cc"), sep = "Note") %>% 
  separate(subcellular_location_cc, into = c("subcellular_location_cc"), sep = "\\;") %>% 
  separate(subcellular_location_cc, into = c("subcellular_location_cc"), sep = "\\{") %>% 
  separate(subcellular_location_cc, into = c("subcellular_location_cc"), sep = "\\,") %>% 
  separate(subcellular_location_cc, into = c("subcellular_location_cc"), sep = "\\.") %>% 
  separate(subcellular_location_cc, into = c("temp", "subcellular_location_cc"), sep = "\\:", fill = "left") %>% 
  #we add a temp column in this last separate(), so we remove it here
  dplyr::select(-temp)

#because of cleaning, some locations were listed as gene names; easy way to omit is if they are a single instance
omit <- 
  subcell %>% 
  count(subcellular_location_cc, sort = TRUE) %>% 
  filter(n == 1) %>% 
  pull(subcellular_location_cc)

#this then filters out the omitted locations
subcell <- 
  subcell %>% 
  #single instances
  filter(!subcellular_location_cc %in% omit) %>% 
  #length is 0 for a few instance; omit
  filter(str_length(subcellular_location_cc) > 0) 

#make it so that white space does not make separate categories
subcell$subcellular_location_cc <- str_trim(subcell$subcellular_location_cc, side = "both") 
```


#Exploratory Data Analysis (EDA)
We are now left with a 'clean' data frame, with a new column called "subcellular_location_cc" which has a simple annotation of where the protein is located in the cell.
```{r}
#What are some of the characteristics of the human protein lengths?
subcell %>% 
  summarize(avg = mean(length), 
            sd = sd(length), 
            median = median(length), 
            min = min(length),
            max = max(length))

#Which subcellular locations have most annotated proteins?
subcell %>% 
  count(subcellular_location_cc, sort = TRUE)

#What is longest protein in each subcellular compartment?
subcell %>% 
  group_by(subcellular_location_cc) %>% 
  summarize(longest = max(length))

```

## First Visualization
The reason we spend so much time 'cleaning' data is so that we can use it for visualization and insight. The goal below is to take the code and progressively build it into a visual. The code for the first visual is given. Your task is to take your knowledge of pipes and enhance the visual.
```{r}
#first visualization that shows a histogram of protein lengths
subcell %>% 
  ggplot(aes(x = length)) +
  geom_histogram(bins = 100)
```

Copy and paste the first visualization code from the last code chunk into this one. Next, you want to filter out the outlier protein lengths, so you call the `subcell` object, but before you pass to `ggplot`, add a step to `filter(length < 10000)`.
```{r}
#filter outlier

```

Again, start with the code from the last chunk and paste into this one. Now, we want to add another filter step, where we want to `filter(subcellular_location_cc == "Nucleus")`. Do you think it will matter if you filter the length first or the subcellular location first? Try both and see if they are different.
```{r}
#focus on one place

```

Great job!